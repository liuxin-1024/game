<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”œèœœå°æ¸¸æˆ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
    }
    body {
      background-color: #fff2f5;
      color: #333;
      padding: 16px;
      max-width: 520px;
      margin: 0 auto;
      min-height: 100vh;
      overflow-x: hidden; /* é˜²æ­¢æ°´å¹³æ»šåŠ¨ */
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .container {
      background-color: rgba(255, 255, 255, 0.45);
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(255, 105, 180, 0.15);
      padding: 20px;
      margin-bottom: 16px;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      width: 92%;
      max-width: 460px;
    }
    h1 {
      color: #ff69b4;
      text-align: center;
      margin-bottom: 16px;
      font-size: 24px;
    }
    .status {
      display: flex;
      justify-content: space-between;
      margin-bottom: 16px;
      font-size: 16px;
    }
    .money {
      font-weight: bold;
      color: #ff69b4;
    }
    .message {
      background-color: rgba(248, 248, 248, 0.6);
      border-left: 4px solid #ff69b4;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 0 8px 8px 0;
      line-height: 1.5;
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
    }
    .dice {
      font-size: 48px;
      text-align: center;
      margin: 16px 0;
      height: 60px;
    }
    .buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 16px;
    }
    button {
      background-color: rgba(255, 105, 180, 0.9);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
      box-shadow: 0 2px 8px rgba(255, 105, 180, 0.3);
    }
    button:hover {
      background-color: rgba(255, 91, 167, 0.95);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 105, 180, 0.4);
    }
    button:active {
      transform: translateY(1px);
    }
    button:disabled {
      background-color: rgba(204, 204, 204, 0.8);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .choice-btn {
      background-color: #ffb6c1;
    }
    .progress {
      height: 10px;
      background-color: #f8f8f8;
      border-radius: 5px;
      margin-top: 16px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background-color: #ff69b4;
      border-radius: 5px;
      transition: width 0.5s;
    }
    .hide {
      display: none;
    }
    .event-icon {
      font-size: 24px;
      margin-right: 8px;
    }
    .blessing {
      color: #ff69b4;
      font-weight: bold;
    }
    .input-area {
      margin-top: 16px;
    }
    .input-area input {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
      margin-bottom: 10px;
    }
    .final-message {
      text-align: center;
      padding: 20px;
      background-color: #fff2f5;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 18px;
      line-height: 1.6;
    }
    .red-packet {
      font-size: 36px;
      text-align: center;
      margin: 16px 0;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    .history {
      max-height: 200px;
      overflow-y: auto;
      margin-top: 16px;
      padding: 8px;
      background-color: rgba(255, 255, 255, 0.6);
      border-radius: 8px;
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
    }
    .history-item {
      padding: 8px 0;
      border-bottom: 1px solid #eee;
      font-size: 14px;
    }
    .mode-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
      padding: 0 5px;
    }
    .mode-btn {
      padding: 15px 10px;
      text-align: center;
      background-color: rgba(255, 209, 220, 0.7);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      backdrop-filter: blur(3px);
      -webkit-backdrop-filter: blur(3px);
      box-shadow: 0 2px 8px rgba(255, 155, 175, 0.2);
    }
    .mode-btn:hover {
      background-color: rgba(255, 155, 175, 0.85);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
    }
    .mode-btn.active {
      background-color: rgba(255, 105, 180, 0.9);
      color: white;
    }
    .mode-title {
      font-weight: bold;
      margin-bottom: 5px;
    }
    .mode-desc {
      font-size: 12px;
      color: #666;
    }
    .admin-panel {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 100;
      max-width: 300px;
    }
    .admin-input {
      width: 100%;
      padding: 8px;
      margin-bottom: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .mode-indicator {
      background-color: #f0f0f0;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 12px;
      display: inline-block;
      margin-bottom: 10px;
    }
    .game-played-notice {
      background-color: #ffe0e9;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 16px;
      text-align: center;
      font-weight: bold;
      color: #ff4081;
    }
    .admin-trigger {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 30px;
      height: 30px;
      background-color: transparent;
      z-index: 99;
    }

    /* è½»æç¤ºæ ·å¼ */
    .toast-container {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2000;
      width: 80%;
      max-width: 300px;
    }
    .toast {
      background-color: #ff69b4;
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      transform: translateY(-20px);
      text-align: center;
      font-size: 14px;
    }
    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* èŠ±ç“£ç‰¹æ•ˆç”»å¸ƒæ ·å¼ */
    #petals-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    /* ç¡®ä¿æ‰€æœ‰ä¸»è¦å†…å®¹å®¹å™¨éƒ½æ°´å¹³å‚ç›´å±…ä¸­ */
    #mode-selection, #game-container, #history-container {
      max-width: 100%;
      width: 92%;
      box-sizing: border-box;
      margin-left: auto;
      margin-right: auto;
    }

    /* ä½¿é¡µé¢åœ¨å¤§å±å¹•ä¸Šçœ‹èµ·æ¥æ›´å¥½ */
    @media (min-height: 700px) {
      body {
        padding: 0;
      }

      .container {
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
  <!-- èŠ±ç“£é£˜è½ç‰¹æ•ˆç”»å¸ƒ -->
  <canvas id="petals-canvas"></canvas>

  <!-- è½»æç¤ºå®¹å™¨ -->
  <div id="toast-container" class="toast-container"></div>

  <div id="admin-trigger" class="admin-trigger"></div>
  <div id="admin-panel" class="admin-panel hide">
    <h3>ç®¡ç†å‘˜é‡ç½®</h3>
    <input type="password" id="admin-password" class="admin-input" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ">
    <button id="admin-reset">é‡ç½®æ¸¸æˆ</button>
  </div>

  <div id="mode-selection" class="container">
    <h1>ç”œèœœå°æ¸¸æˆ</h1>
    <div id="played-notice" class="game-played-notice hide">
      æ‚¨å·²ç»ç©è¿‡ä¸€æ¬¡æ¸¸æˆå•¦~<br>
      ä»¥ä¸‹æ˜¯æ‚¨ä¸Šæ¬¡çš„æ¸¸æˆè®°å½•
    </div>
    <div id="mode-container">
      <p>è¯·é€‰æ‹©æ¸¸æˆéš¾åº¦æ¨¡å¼ï¼š</p>
      <div class="mode-grid" id="mode-grid">
        <!-- æ¨¡å¼å°†ç”±JavaScriptåŠ¨æ€å¡«å…… -->
      </div>
      <div style="text-align: center; margin-top: 20px;">
        <button id="secret-mode-btn" style="background-color: rgba(255, 105, 180, 0.85); padding: 10px 20px; border-radius: 20px; backdrop-filter: blur(3px); box-shadow: 0 3px 10px rgba(255, 105, 180, 0.3);">
          è§£é”éšè—æ¨¡å¼ ğŸ’–
        </button>
      </div>
      <div style="text-align: center; margin-top: 20px; font-size: 12px; color: #666;">
        Designed by LX
      </div>
    </div>
  </div>

  <div id="game-container" class="container hide">
    <h1>ç”œèœœå°æ¸¸æˆ</h1>
    <div class="mode-indicator" id="mode-indicator">æ¨¡å¼1: åˆæ‹ç”œèœœ</div>
    <div class="status">
      <div>ğŸ‘¸ èµ„é‡‘: <span id="player-money" class="money">5.2</span>å…ƒ</div>
      <div>ğŸ¤– å¥–æ± : <span id="bot-money" class="money">20</span>å…ƒ</div>
    </div>
    <div class="progress">
      <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
    </div>
    <div id="message" class="message">
      å®è´ï¼Œæˆ‘ä»¬æ¥ç©ä¸ªè¶…ç”œå°æ¸¸æˆï¼<br>
      ä½ åˆå§‹èµ„é‡‘ğŸ’°ï¼š5.2å…ƒï¼ˆæˆ‘çˆ±ä½ å“Ÿ~ï¼‰<br>
      æˆ‘å‡ºå¥–æ± ï¼Œèµšåˆ°ç›®æ ‡é‡‘é¢æˆ‘å°±è®¤è¾“ï¼<br>
    </div>
    <div id="dice" class="dice"></div>
    <div id="buttons" class="buttons">
      <button id="start-btn">å¼€å§‹æ¸¸æˆ</button>
    </div>
    <div id="input-area" class="input-area hide">
      <input type="text" id="input-text" placeholder="è¯·è¾“å…¥...">
      <button id="submit-btn">ç¡®å®š</button>
    </div>
  </div>

  <div id="history-container" class="container hide">
    <h1>æ¸¸æˆè®°å½•</h1>
    <div id="history" class="history"></div>
    <div style="margin-top: 20px; text-align: center;">
      <button id="reset-game-btn" style="background-color: #ff4081;">é‡ç½®æ¸¸æˆ</button>
    </div>
  </div>

  <div id="reset-modal" class="hide" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;">
    <div style="background-color: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 300px;">
      <h3 style="text-align: center; margin-bottom: 15px;">è¾“å…¥ç®¡ç†å‘˜å¯†ç </h3>
      <input type="password" id="reset-password" style="width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 5px; border: 1px solid #ddd;" placeholder="è¯·è¾“å…¥å¯†ç ">
      <div style="display: flex; justify-content: space-between;">
        <button id="cancel-reset" style="background-color: #ccc; flex: 1; margin-right: 10px;">å–æ¶ˆ</button>
        <button id="confirm-reset" style="background-color: #ff4081; flex: 1;">ç¡®è®¤é‡ç½®</button>
      </div>
    </div>
  </div>

  <div id="secret-mode-modal" class="hide" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 1000;">
    <div style="background-color: white; padding: 20px; border-radius: 10px; width: 80%; max-width: 300px;">
      <h3 style="text-align: center; margin-bottom: 15px;">è¾“å…¥éšè—æ¨¡å¼å¯†ç </h3>
      <input type="password" id="secret-mode-password" style="width: 100%; padding: 10px; margin-bottom: 15px; border-radius: 5px; border: 1px solid #ddd;" placeholder="è¯·è¾“å…¥å¯†ç ">
      <div style="display: flex; justify-content: space-between;">
        <button id="cancel-secret" style="background-color: #ccc; flex: 1; margin-right: 10px;">å–æ¶ˆ</button>
        <button id="confirm-secret" style="background-color: #ff69b4; flex: 1;">ç¡®è®¤</button>
      </div>
    </div>
  </div>

    <script>
    // ç®¡ç†å‘˜å¯†ç 
    const ADMIN_PASSWORD = "lx6666";

    // éšè—æ¨¡å¼å¯†ç 
    const SECRET_MODE_PASSWORD = "zly6666";

    // åˆ›å»ºè½»æç¤ºå‡½æ•°
    function showToast(message, duration = 3000) {
      const toastContainer = document.getElementById('toast-container');

      // åˆ›å»ºæç¤ºå…ƒç´ 
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.textContent = message;

      // æ·»åŠ åˆ°å®¹å™¨
      toastContainer.appendChild(toast);

      // æ˜¾ç¤ºæç¤º
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);

      // è‡ªåŠ¨å…³é—­
      setTimeout(() => {
        toast.classList.remove('show');

        // ç§»é™¤å…ƒç´ 
        setTimeout(() => {
          toastContainer.removeChild(toast);
        }, 300);
      }, duration);
    };

    // æ¸¸æˆæ¨¡å¼é…ç½®
    const GAME_MODES = [
      {
        id: 1,
        name: "åˆæ‹ç”œèœœ",
        description: "æ¸©æŸ”çš„åˆæ‹ä½“éªŒï¼Œç¨³å®šæ”¶ç›Š",
        playerMoney: 5.2,
        botMoney: 20,
        target: 15,
        winChance: 0.6, // 60%èµ¢ï¼Œ40%è¾“
        loseChance: 0.4,
        eventMultiplier: 1.0,
        maxLoss: 2.0, // å¯èƒ½ä¼šäºä¸€ç‚¹
        maxWin: 10.0  // æœ€å¤šèµ¢10å…ƒ
      },
      {
        id: 2,
        name: "æš§æ˜§æµªæ¼«",
        description: "è½»æ¾æµªæ¼«ï¼Œæ”¶ç›Šä¸é£é™©å¹¶å­˜",
        playerMoney: 5.2,
        botMoney: 30,
        target: 20,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 1.2,
        maxLoss: 3.0, // å¯èƒ½ä¼šäºä¸€äº›
        maxWin: 20.0  // æœ€å¤šèµ¢20å…ƒ
      },
      {
        id: 3,
        name: "çƒ­æ‹å‘Šç™½",
        description: "ç”œèœœå‰§æƒ…ï¼Œé£é™©ä¸æ”¶ç›Šå¹³è¡¡",
        playerMoney: 5.2,
        botMoney: 40,
        target: 25,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 1.5,
        maxLoss: 4.0, // å¯èƒ½ä¼šäºæ›´å¤š
        maxWin: 30.0  // æœ€å¤šèµ¢30å…ƒ
      },
      {
        id: 4,
        name: "ç¼ ç»µå¯†è¯­",
        description: "æ›´å¤šç”œèœœæ•…äº‹ï¼Œé£é™©ä¸å›æŠ¥å¹¶å­˜",
        playerMoney: 5.2,
        botMoney: 50,
        target: 30,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 1.8,
        maxLoss: 5.0, // å¯èƒ½ä¼šäºæ›´å¤š
        maxWin: 40.0  // æœ€å¤šèµ¢40å…ƒ
      },
      {
        id: 5,
        name: "ç”œèœœå¹³è¡¡",
        description: "èµšèµ”å¹³è¡¡ï¼Œå‰§æƒ…æ›´ä¸°å¯Œ",
        playerMoney: 5.2,
        botMoney: 60,
        target: 35,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 2.0,
        maxLoss: 5.0, // å¯èƒ½ä¼šäºå¾ˆå¤š
        maxWin: 50.0  // æœ€å¤šèµ¢50å…ƒ
      },
      {
        id: 6,
        name: "æƒ…ä¾£æŒ‘æˆ˜",
        description: "æœ‰ä¸€å®šé£é™©çš„ç”œèœœä½“éªŒ",
        playerMoney: 5.2,
        botMoney: 70,
        target: 40,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 2.2,
        maxLoss: 5.0, // å¯èƒ½ä¼šäºå¾ˆå¤š
        maxWin: 60.0  // æœ€å¤šèµ¢60å…ƒ
      },
      {
        id: 7,
        name: "çˆ±æƒ…å†’é™©",
        description: "æ›´é«˜é£é™©ä¼´éšæ›´é«˜æ”¶ç›Š",
        playerMoney: 5.2,
        botMoney: 80,
        target: 45,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 2.5,
        maxLoss: 5.0, // å¯èƒ½ä¼šäºå¾ˆå¤š
        maxWin: 70.0  // æœ€å¤šèµ¢70å…ƒ
      },
      {
        id: 8,
        name: "æ¿€æƒ…å››å°„",
        description: "å¤§èµ·å¤§è½çš„åˆºæ¿€ä½“éªŒ",
        playerMoney: 5.2,
        botMoney: 90,
        target: 50,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 3.0,
        maxLoss: 5.0, // å¯èƒ½ä¼šäºå¾ˆå¤š
        maxWin: 80.0  // æœ€å¤šèµ¢80å…ƒ
      },
      {
        id: 9,
        name: "çˆ±çš„è€ƒéªŒ",
        description: "é«˜é£é™©é«˜å›æŠ¥çš„æµªæ¼«ä¹‹æ—…",
        playerMoney: 5.2,
        botMoney: 100,
        target: 55,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 3.5,
        maxLoss: 5.0, // å¯èƒ½ä¼šäºå¾ˆå¤š
        maxWin: 90.0  // æœ€å¤šèµ¢90å…ƒ
      },
      {
        id: 10,
        name: "è‡³æ­»ä¸æ¸",
        description: "æè‡´ä½“éªŒï¼Œå¤§èµ·å¤§è½",
        playerMoney: 5.2,
        botMoney: 110,
        target: 60,
        winChance: 0.6,
        loseChance: 0.4,
        eventMultiplier: 4.0,
        maxLoss: 5.2, // å¯èƒ½ä¼šè¾“å…‰
        maxWin: 100.0 // æœ€å¤šèµ¢100å…ƒ
      },
      {
        id: 99, // éšè—æ¨¡å¼
        name: "ç”œèœœå®è—",
        description: "âœ¨éšè—æ¨¡å¼âœ¨ 100%èµ¢é’±ï¼Œå°é¢ç¨³èµš",
        playerMoney: 5.2,
        botMoney: 50,
        target: 15,
        winChance: 1.0, // 100%èµ¢ï¼Œ0%è¾“
        loseChance: 0.0,
        eventMultiplier: 0.8,
        maxLoss: 0.0, // ä¸ä¼šäºé’±
        maxWin: 5.0,  // æœ€å¤šèµ¢5å…ƒ
        isHidden: true // æ ‡è®°ä¸ºéšè—æ¨¡å¼
      }
    ];

    // æ¸¸æˆåŸºç¡€äº‹ä»¶åˆ—è¡¨ - ä¼šæ ¹æ®æ¨¡å¼åŠ¨æ€æ‰©å±•
    const BASE_EVENTS = [
      {
        type: 'good',
        icon: 'âœ¨',
        title: 'æŠ“åˆ°å°ç²¾çµ',
        description: 'è·å¾—ç²¾çµç¥ç¦ï¼šä¸‹æ¬¡æ”¶ç›Šç¿»å€ï¼',
        effect: () => {
          gameState.blessing = true;
          return 0;
        }
      },
      {
        type: 'good',
        icon: 'ğŸ’¼',
        title: 'å†’é™©å¼€å¥¶èŒ¶åº—',
        description: 'ç”Ÿæ„å…´éš†ï¼Œå®¢äººç»œç»ä¸ç»ï¼',
        effect: (dice) => {
          const amount = dice * 0.5;
          return gameState.blessing ? amount * 2 : amount;
        }
      },
      {
        type: 'bad',
        icon: 'ğŸ˜¿',
        title: 'é‡åˆ°å°åƒè´§',
        description: 'è¯·æˆ‘åƒå†°æ·‡æ·‹ğŸ¦ï¼ŒèŠ±è´¹1å…ƒï½',
        effect: () => -1
      },
      {
        type: 'good',
        icon: 'ğŸ«',
        title: 'åˆ®åˆ®ä¹ä¸­å¥–',
        description: 'å–œæç°é‡‘å¥–åŠ±ï¼',
        effect: (dice) => dice * 0.4
      },
      {
        type: 'bad',
        icon: 'â›ˆï¸',
        title: 'çªç„¶ä¸‹é›¨',
        description: 'æ‰“è½¦å›å®¶èŠ±è´¹0.8å…ƒ',
        effect: () => -0.8
      },
      {
        type: 'good',
        icon: 'ğŸŒˆ',
        title: 'è·¯è¾¹æ¡åˆ°å½©è™¹ä¼',
        description: 'ä¸ä»…å…è´¹ï¼Œè¿˜é™„èµ ç°é‡‘ï¼',
        effect: () => 1
      },
      {
        type: 'good',
        icon: 'ğŸ',
        title: 'å‘¨å¹´çºªå¿µæ—¥',
        description: 'ä½ é€å¥¹ç¤¼ç‰©ğŸï¼Œå¥¹æ„ŸåŠ¨è½¬è´¦',
        effect: (dice) => dice * 0.8
      },
      {
        type: 'bad',
        icon: 'ğŸ“±',
        title: 'ç½‘è´­å†²åŠ¨ç—‡',
        description: 'çœ‹åˆ°å–œæ¬¢çš„ä¸œè¥¿ä¹°ä¸‹äº†',
        effect: () => -0.5
      },
      {
        type: 'good',
        icon: 'ğŸ’¸',
        title: 'ç†è´¢æœ‰é“',
        description: 'æŠ•èµ„å°æœ‰æ‰€æˆ',
        effect: (dice) => dice * 0.3
      },
      {
        type: 'good',
        icon: 'ğŸ¯',
        title: 'å‚åŠ æŠ½å¥–æ´»åŠ¨',
        description: 'å¥½è¿çˆ†æ£šä¸­å¥–äº†ï¼',
        effect: () => 2
      }
    ];

    // é¢å¤–äº‹ä»¶é›†åˆï¼Œæ ¹æ®æ¨¡å¼éš¾åº¦é€æ¸è§£é”
    const EXTRA_EVENTS = {
      good: [
        {
          icon: 'ğŸ’',
          title: 'æ”¶åˆ°æƒŠå–œç¤¼ç‰©',
          description: 'æ‹äººé€äº†ä¸€ä»½æƒŠå–œç¤¼ç‰©ï¼Œé™„å¸¦ç°é‡‘çº¢åŒ…',
          effect: (dice) => dice * 0.6
        },
        {
          icon: 'ğŸ†',
          title: 'èµ¢å¾—æ¯”èµ›å¥–é‡‘',
          description: 'å‚åŠ äº†å½“åœ°çš„æ‰è‰ºæ¯”èµ›ï¼Œè·å¾—å¥–é‡‘',
          effect: (dice) => dice * 0.7
        },
        {
          icon: 'ğŸ’Œ',
          title: 'æ”¶åˆ°å‘Šç™½ä¿¡',
          description: 'ä¿¡ä¸­é™„å¸¦äº†å¯¹æ–¹çš„å¿ƒæ„å’Œä¸€ç‚¹é›¶èŠ±é’±',
          effect: () => 1.5
        },
        {
          icon: 'ğŸŠ',
          title: 'ç”Ÿæ—¥æ´¾å¯¹',
          description: 'æœ‹å‹ä»¬é€ä¸Šç¥ç¦å’Œçº¢åŒ…',
          effect: (dice) => dice * 0.5 + 1
        },
        {
          icon: 'ğŸ‘‘',
          title: 'æˆä¸ºå¹¸è¿é¡¾å®¢',
          description: 'å•†åœºæ´»åŠ¨ä¸­è¢«é€‰ä¸ºå¹¸è¿é¡¾å®¢ï¼Œè·å¾—è´­ç‰©åˆ¸',
          effect: () => 2.5
        },
        {
          icon: 'ğŸ§§',
          title: 'æ”¶åˆ°å‹å²é’±',
          description: 'é•¿è¾ˆç»™äº†ä¸€ä¸ªå¤§çº¢åŒ…',
          effect: (dice) => dice + 1
        },
        {
          icon: 'ğŸµ',
          title: 'è¡—å¤´æ¼”å”±',
          description: 'å³å…´è¡—å¤´æ¼”å”±ï¼Œè·¯äººæ‰“èµ',
          effect: (dice) => dice * 0.4 + 0.5
        },
        {
          icon: 'ğŸ€',
          title: 'æ¡åˆ°å››å¶è‰',
          description: 'å¸¦æ¥å¥½è¿ï¼Œä¸‹æ¬¡æ”¶ç›Šå¢åŠ 50%',
          effect: () => {
            gameState.luckyClover = true;
            return 0.5;
          }
        },
        {
          icon: 'ğŸ’‘',
          title: 'ç”œèœœçº¦ä¼š',
          description: 'å¯¹æ–¹ä¸»åŠ¨ä¹°å•å¹¶ç»™äºˆå°æƒŠå–œ',
          effect: () => 1.8
        },
        {
          icon: 'ğŸŒŸ',
          title: 'é—ªè€€æ—¶åˆ»',
          description: 'æ„å¤–æˆä¸ºç½‘çº¢ï¼Œè·å¾—å“ç‰Œåˆä½œ',
          effect: (dice) => dice * 1.2
        },
        // æ–°å¢ç”œèœœäº‹ä»¶
        {
          icon: 'ğŸŒ¸',
          title: 'èŠ±æµ·æ¼«æ­¥',
          description: 'åœ¨èŠ±æµ·ä¸­æ¼«æ­¥ï¼Œæ‹äººé€ä½ ä¸€æœµæ¼‚äº®çš„èŠ±ï¼ŒèŠ±ä¸­æœ‰å°æƒŠå–œ',
          effect: () => 1.2
        },
        {
          icon: 'ğŸ­',
          title: 'è¡—å¤´è‰ºæœ¯è¡¨æ¼”',
          description: 'å‚ä¸è¡—å¤´è‰ºæœ¯è¡¨æ¼”ï¼Œè·å¾—èµèµå’Œæ‰“èµ',
          effect: (dice) => dice * 0.5 + 0.8
        },
        {
          icon: 'ğŸ«',
          title: 'å·§å…‹åŠ›æƒŠå–œ',
          description: 'æ”¶åˆ°ä¸€ç›’æ‰‹å·¥å·§å…‹åŠ›ï¼Œå†…è—çˆ±çš„ä¿¡æ¯å’Œå°çº¢åŒ…',
          effect: () => 1.6
        },
        {
          icon: 'ğŸ’ƒ',
          title: 'èˆä¼šä¸»è§’',
          description: 'åœ¨èˆä¼šä¸Šæˆä¸ºç„¦ç‚¹ï¼Œè·å¾—ç‰¹åˆ«å¥–åŠ±',
          effect: (dice) => dice * 0.8
        },
        {
          icon: 'ğŸï¸',
          title: 'æµ·æ»©å¹¸è¿æ—¥',
          description: 'åœ¨æµ·æ»©ä¸Šæ¡åˆ°ä¸€ä¸ªæ¼‚äº®çš„è´å£³ï¼Œå†…æœ‰ä¸€å¼ å½©ç¥¨',
          effect: (dice) => dice * 0.7 + 1
        },
        {
          icon: 'ğŸ°',
          title: 'ç”œå“åº—æƒŠå–œ',
          description: 'åœ¨ç”œå“åº—æˆä¸ºç¬¬1000ä½é¡¾å®¢ï¼Œè·å¾—å…å•å’Œå¥–é‡‘',
          effect: () => 2.2
        },
        {
          icon: 'ğŸˆ',
          title: 'æ°”çƒæƒŠå–œ',
          description: 'æ”¶åˆ°ä¸€æŸæ°”çƒï¼Œæ¯ä¸ªæ°”çƒé‡Œéƒ½è—ç€å°çº¸æ¡å’Œé›¶é’±',
          effect: (dice) => dice * 0.3 + 1.5
        },
        {
          icon: 'ğŸ“š',
          title: 'ä¹¦ä¸­ç§˜å¯†',
          description: 'åœ¨å–œæ¬¢çš„ä¹¦ä¸­å‘ç°è—ç€çš„é’±å¸å’Œç”œèœœç•™è¨€',
          effect: () => 1.4
        },
        {
          icon: 'ğŸ§š',
          title: 'å¹¸è¿ç²¾çµçœ·é¡¾',
          description: 'è¢«å¹¸è¿ç²¾çµçœ·é¡¾ï¼Œéšèº«ç‰©å“ä»·å€¼ä¸Šæ¶¨',
          effect: (dice) => dice * 0.9
        },
        {
          icon: 'ğŸ¬',
          title: 'ç”µå½±ç‰‡åœºå¶é‡',
          description: 'åœ¨ç”µå½±ç‰‡åœºå¶é‡æ˜æ˜Ÿï¼Œè·å¾—ç­¾åå‘¨è¾¹å’Œå¥–åŠ±',
          effect: () => 2.0
        }
      ],
      bad: [
        {
          icon: 'ğŸš—',
          title: 'äº¤é€šç½šå•',
          description: 'ä¸å°å¿ƒé—¯çº¢ç¯è¢«ç½šæ¬¾',
          effect: () => -1.2
        },
        {
          icon: 'ğŸ“‰',
          title: 'æŠ•èµ„å¤±è¯¯',
          description: 'è‚¡ç¥¨ä¸‹è·Œï¼ŒæŸå¤±ä¸€äº›èµ„é‡‘',
          effect: (dice) => -dice * 0.3
        },
        {
          icon: 'â˜”',
          title: 'å¤§é›¨å¤©',
          description: 'æ‰‹æœºè¢«é›¨æ°´æ·‹æ¹¿ï¼Œéœ€è¦ç»´ä¿®',
          effect: () => -1.5
        },
        {
          icon: 'ğŸ¤’',
          title: 'å°æ„Ÿå†’',
          description: 'éœ€è¦ä¹°è¯å’Œè¥å…»å“',
          effect: () => -0.7
        },
        {
          icon: 'ğŸ®',
          title: 'æ¸¸æˆå……å€¼',
          description: 'å¿ä¸ä½ç»™å–œæ¬¢çš„æ¸¸æˆå……äº†å€¼',
          effect: (dice) => -dice * 0.25
        },
        {
          icon: 'ğŸ›ï¸',
          title: 'è´­ç‰©ç‹‚æ¬¢',
          description: 'å¿ä¸ä½åœ¨è´­ç‰©èŠ‚ä¹°äº†å¾ˆå¤šä¸œè¥¿',
          effect: (dice) => -dice * 0.4 - 0.5
        },
        {
          icon: 'ğŸ½ï¸',
          title: 'å¤§é¤æ¶ˆè´¹',
          description: 'å’Œæœ‹å‹èšé¤ï¼ŒAAåˆ¶ä»˜æ¬¾',
          effect: () => -1.8
        },
        {
          icon: 'ğŸ“²',
          title: 'æ‰‹æœºæ›´æ–°',
          description: 'æ—§æ‰‹æœºä¸è¡Œäº†ï¼Œä¹°äº†æ–°é…ä»¶',
          effect: (dice) => -dice * 0.5
        },
        {
          icon: 'ğŸš‡',
          title: 'åœ°é“å¡ä¸¢å¤±',
          description: 'æœˆå¡ä¸¢å¤±ï¼Œéœ€è¦è¡¥åŠ',
          effect: () => -0.9
        },
        {
          icon: 'ğŸ“š',
          title: 'ä¹°æ–°ä¹¦',
          description: 'çœ‹åˆ°å–œæ¬¢çš„ä¹¦ç±ï¼Œå¿ä¸ä½ä¹°ä¸‹',
          effect: () => -1.1
        },
        // æ–°å¢é£é™©äº‹ä»¶
        {
          icon: 'ğŸ¸',
          title: 'éŸ³ä¹ä¼šæ¶ˆè´¹',
          description: 'ä¸ºäº†çœ‹å–œæ¬¢çš„æ¼”å”±ä¼šä¹°äº†è´µç¥¨',
          effect: (dice) => -dice * 0.6 - 0.4
        },
        {
          icon: 'ğŸ§£',
          title: 'å­£èŠ‚æ¢è£…',
          description: 'å­£èŠ‚å˜åŒ–ï¼Œè´­ä¹°äº†æ–°è¡£ç‰©',
          effect: () => -1.6
        },
        {
          icon: 'ğŸ‚',
          title: 'ç”Ÿæ—¥ç¤¼ç‰©',
          description: 'ä¸ºæ‹äººå‡†å¤‡äº†è´µé‡ç”Ÿæ—¥ç¤¼ç‰©',
          effect: (dice) => -dice * 0.7
        },
        {
          icon: 'ğŸ ',
          title: 'å®¶å…·æ›´æ–°',
          description: 'æ›´æ¢äº†ä¸€äº›å°å®¶å…·å’Œè£…é¥°å“',
          effect: () => -2.0
        },
        {
          icon: 'ğŸ',
          title: 'èŠ‚æ—¥é€ç¤¼',
          description: 'èŠ‚æ—¥æœŸé—´ç»™äº²å‹å‡†å¤‡äº†ç¤¼ç‰©',
          effect: (dice) => -dice * 0.3 - 0.7
        },
        {
          icon: 'ğŸš–',
          title: 'æ‰“è½¦è´¹ç”¨',
          description: 'ä¸€å‘¨å¤šæ¬¡æ‰“è½¦ï¼Œç´¯è®¡èŠ±è´¹ä¸å°‘',
          effect: () => -1.4
        },
        {
          icon: 'â˜•',
          title: 'å’–å•¡ä¸Šç˜¾',
          description: 'ä¸€å‘¨å†…å¤šæ¬¡å…‰é¡¾é«˜çº§å’–å•¡åº—',
          effect: () => -1.3
        },
        {
          icon: 'ğŸ’„',
          title: 'ç¾å¦†æ¶ˆè´¹',
          description: 'è´­ä¹°äº†ä¸€äº›å¿ƒä»ªå·²ä¹…çš„ç¾å¦†äº§å“',
          effect: (dice) => -dice * 0.4 - 0.3
        },
        {
          icon: 'ğŸ¨',
          title: 'è‰ºæœ¯å±•é—¨ç¥¨',
          description: 'å‚è§‚äº†ä¸€ä¸ªé«˜ä»·å€¼çš„è‰ºæœ¯å±•è§ˆ',
          effect: () => -1.7
        },
        {
          icon: 'ğŸ”§',
          title: 'æ—¥å¸¸ç»´ä¿®',
          description: 'å®¶ä¸­ç‰©å“éœ€è¦ç»´ä¿®ï¼Œæ”¯ä»˜äº†è´¹ç”¨',
          effect: (dice) => -dice * 0.3 - 0.4
        }
      ]
    };

    // é€‰æ‹©åˆ—è¡¨åŸºç¡€ç‰ˆ - æ ¹æ®æ¨¡å¼éš¾åº¦ä¼šåŠ¨æ€æ‰©å±•
    const BASE_CHOICES = [
      {
        title: 'æŠ•èµ„æ–¹å‘',
        options: [
          { text: 'ç¨³å¥ç†è´¢ï¼ˆä¿æœ¬å°èµšï¼‰', effect: () => 0.5 },
          { text: 'å†’é™©åˆ›ä¸šï¼ˆå¯èƒ½æš´å¯Œï¼‰', effect: (dice) => dice > 3 ? dice * 0.7 : -0.3 }
        ]
      },
      {
        title: 'è¦ä¸è¦æŠ¥ä»‡',
        options: [
          { text: 'ç¨³å¥å­˜é’±ï¼ˆç¨³èµš0.5å…ƒï¼‰', effect: () => 0.5 },
          { text: 'ä¹°åˆ®åˆ®ä¹ï¼ˆå¯èƒ½ä¸­å¤§å¥–ï¼‰', effect: (dice) => dice > 2 ? dice * 0.6 : -0.3 }
        ]
      },
      {
        title: 'é€‰æ‹©é›¨å…·',
        options: [
          { text: 'ä¹°ä¼ï¼ˆ-0.3å…ƒä½†é˜²é›¨ï¼‰', effect: () => -0.3 },
          { text: 'æ·‹é›¨è·‘ï¼ˆå¯èƒ½æ„Ÿå†’æ‰£é’±ï¼‰', effect: (dice) => dice > 4 ? 0 : -0.5 }
        ]
      }
    ];

    // é¢å¤–é€‰æ‹©ï¼Œæ ¹æ®æ¨¡å¼éš¾åº¦è§£é”
    const EXTRA_CHOICES = [
      {
        title: 'å‘¨æœ«å®‰æ’',
        options: [
          { text: 'å®…å®¶çœ‹å‰§ï¼ˆä¸èŠ±é’±ï¼‰', effect: () => 0 },
          { text: 'å¤–å‡ºæ—…è¡Œï¼ˆèŠ±é’±ä½†å¯èƒ½æœ‰æƒŠå–œï¼‰', effect: (dice) => dice > 3 ? dice * 0.8 : -dice * 0.4 }
        ]
      },
      {
        title: 'æ‹äººç¤¼ç‰©',
        options: [
          { text: 'æ‰‹å·¥åˆ¶ä½œï¼ˆèŠ±å°‘é‡é’±ï¼‰', effect: () => -0.2 },
          { text: 'ä¹°å¥¢ä¾ˆå“ï¼ˆèŠ±å¾ˆå¤šé’±ä½†å¯èƒ½è·å¾—æƒŠå–œï¼‰', effect: (dice) => dice > 4 ? dice * 1.2 : -dice * 0.8 }
        ]
      },
      {
        title: 'æœ‹å‹æ±‚åŠ©',
        options: [
          { text: 'å€Ÿé’±ç»™æœ‹å‹ï¼ˆå¯èƒ½æœ‰é£é™©ï¼‰', effect: (dice) => dice > 5 ? dice * 0.5 : -dice * 0.4 },
          { text: 'å©‰æ‹’ï¼ˆä¿ä½é’±ä½†å¤±å»æœºä¼šï¼‰', effect: () => 0.1 }
        ]
      },
      {
        title: 'çªå‘ä¼˜æƒ ',
        options: [
          { text: 'å›¤è´§ï¼ˆç°åœ¨å¤šèŠ±é’±æœªæ¥çœé’±ï¼‰', effect: (dice) => dice > 3 ? dice * 0.6 : -dice * 0.3 },
          { text: 'æ”¾å¼ƒï¼ˆä¿å®ˆç­–ç•¥ï¼‰', effect: () => 0.2 }
        ]
      },
      {
        title: 'å­¦ä¹ æŠ•èµ„',
        options: [
          { text: 'è´­ä¹°è¯¾ç¨‹ï¼ˆå‰æœŸæŠ•å…¥ï¼‰', effect: (dice) => -0.8 },
          { text: 'è‡ªå­¦ï¼ˆçœé’±ä½†æ”¶ç›Šæ…¢ï¼‰', effect: () => 0.3 }
        ]
      },
      {
        title: 'æ‹çˆ±çºªå¿µæ—¥',
        options: [
          { text: 'è±ªåçº¦ä¼šï¼ˆå¤§æ‰‹ç¬”ï¼‰', effect: (dice) => dice > 4 ? dice * 1.0 : -dice * 0.6 },
          { text: 'æ¸©é¦¨å®¶åº­æ—¥ï¼ˆçœé’±æš–å¿ƒï¼‰', effect: () => 0.4 }
        ]
      },
      {
        title: 'å¶é‡è·¯äºº',
        options: [
          { text: 'å¸®åŠ©å¯¹æ–¹ï¼ˆä»˜å‡ºä½†å¯èƒ½æœ‰å›æŠ¥ï¼‰', effect: (dice) => dice > 3 ? dice * 0.7 : -0.5 },
          { text: 'åŒ†åŒ†ç¦»å¼€ï¼ˆä¸èŠ±é’±ä½†å¤±å»æœºä¼šï¼‰', effect: () => 0 }
        ]
      },
      // æ–°å¢é€‰æ‹©åœºæ™¯
      {
        title: 'æƒŠå–œå‘Šç™½',
        options: [
          { text: 'ç²¾å¿ƒå‡†å¤‡ï¼ˆèŠ±é’±ä½†å¢è¿›æ„Ÿæƒ…ï¼‰', effect: (dice) => dice > 3 ? dice * 0.9 : -dice * 0.5 },
          { text: 'ç®€å•è¡¨è¾¾ï¼ˆçœé’±ä½†æ•ˆæœä¸€èˆ¬ï¼‰', effect: () => 0.3 }
        ]
      },
      {
        title: 'çº¦ä¼šé¤å…',
        options: [
          { text: 'é«˜çº§é¤å…ï¼ˆè´µä½†æ°›å›´å¥½ï¼‰', effect: (dice) => dice > 4 ? dice * 1.1 : -dice * 0.7 },
          { text: 'è¡—è¾¹å°é¦†ï¼ˆä¾¿å®œä½†æ¸©é¦¨ï¼‰', effect: () => 0.5 }
        ]
      },
      {
        title: 'ç”Ÿæ—¥é€‰æ‹©',
        options: [
          { text: 'æƒŠå–œæ´¾å¯¹ï¼ˆèŠ±é’±ä½†éš¾å¿˜ï¼‰', effect: (dice) => dice > 3 ? dice * 1.0 : -dice * 0.6 },
          { text: 'ç§å¯†åº†ç¥ï¼ˆèŠ‚çº¦ä½†æ¸©æƒ…ï¼‰', effect: () => 0.4 }
        ]
      },
      {
        title: 'åº¦å‡æ–¹æ¡ˆ',
        options: [
          { text: 'è±ªåé…’åº—ï¼ˆå¥¢ä¾ˆä½†äº«å—ï¼‰', effect: (dice) => dice > 4 ? dice * 1.2 : -dice * 0.8 },
          { text: 'æ°‘å®¿ä½“éªŒï¼ˆç»æµä½†æœ‰è¶£ï¼‰', effect: () => 0.6 }
        ]
      },
      {
        title: 'è´­ç‰©é€‰æ‹©',
        options: [
          { text: 'å“ç‰Œä¸“æŸœï¼ˆè´µä½†å“è´¨å¥½ï¼‰', effect: (dice) => dice > 3 ? dice * 0.8 : -dice * 0.5 },
          { text: 'ç½‘è´­æŠ˜æ‰£ï¼ˆä¾¿å®œä½†ç­‰å¾…é•¿ï¼‰', effect: () => 0.4 }
        ]
      },
      {
        title: 'ç”µå½±å¤œ',
        options: [
          { text: 'ç”µå½±é™¢VIPï¼ˆè´µä½†ä½“éªŒå¥½ï¼‰', effect: (dice) => dice > 3 ? dice * 0.7 : -dice * 0.4 },
          { text: 'å®¶åº­å½±é™¢ï¼ˆçœé’±ä½†æ¸©é¦¨ï¼‰', effect: () => 0.3 }
        ]
      },
      {
        title: 'ç¤¼ç‰©åŒ…è£…',
        options: [
          { text: 'ä¸“ä¸šåŒ…è£…ï¼ˆè´µä½†ç²¾ç¾ï¼‰', effect: (dice) => dice > 2 ? dice * 0.5 : -dice * 0.3 },
          { text: 'äº²æ‰‹åŒ…è£…ï¼ˆçœé’±ä½†æœ‰å¿ƒæ„ï¼‰', effect: () => 0.4 }
        ]
      }
    ];

    // ç”œèœœå‘Šç™½è¯­åˆ—è¡¨
    const SWEET_MESSAGES = [
      "ä½ èµ¢èµ°äº†æˆ‘çš„é’±ï¼Œä¹Ÿèµ¢èµ°äº†æˆ‘çš„å¿ƒ",
      "æ„¿æˆ‘çš„å¿ƒå’Œçº¢åŒ…ï¼Œéƒ½èƒ½å¸¦ç»™ä½ å¹¸ç¦",
      "å’Œä½ åœ¨ä¸€èµ·çš„æ¯ä¸€ç§’ï¼Œéƒ½å€¼å¾—æˆ‘å€¾å°½æ‰€æœ‰",
      "ä½ çš„ç¬‘å®¹ï¼Œæ¯”æ‰€æœ‰çš„é‡‘é’±éƒ½çè´µ",
      "è¾“ç»™ä½ ï¼Œæ˜¯æˆ‘ä»Šç”Ÿæœ€ç”œèœœçš„è´¥ä»—",
      "æ„¿è¿™äº›å°é’±ï¼Œæ¢ä½ ä¸€ç”Ÿçš„å¹¸ç¦ç¬‘é¢œ",
      "é‡è§ä½ ï¼Œæ˜¯æˆ‘æœ€å€¼å¾—çš„æŠ•èµ„",
      "ä½ æ˜¯æˆ‘æœ€çè´µçš„è´¢å¯Œï¼Œèƒœè¿‡ä¸–é—´ä¸‡è´¯å®¶è´¢",
      "æ„¿è¿™å°å°å¿ƒæ„ï¼Œèƒ½è®©ä½ æ„Ÿå—æˆ‘æµ“æµ“çš„çˆ±",
      "ä½ èµ¢äº†æ¸¸æˆï¼Œæˆ‘èµ¢äº†çˆ±æƒ…",
      // æ–°å¢å‘Šç™½è¯­
      "æ¯ä¸€æšç¡¬å¸éƒ½æ‰¿è½½ç€æˆ‘å¯¹ä½ çš„çˆ±ï¼Œè€Œè¿™çˆ±æ— ä»·",
      "é’±è´¢ä¼šæµå¤±ï¼Œä½†æˆ‘å¯¹ä½ çš„çˆ±ä¼šæ°¸æ’",
      "ä½ çš„æ¯ä¸ªå¾®ç¬‘ï¼Œéƒ½è®©æˆ‘æ„¿æ„å€¾å°½æ‰€æœ‰",
      "æ„¿è¿™çº¢åŒ…å¸¦ç»™ä½ å¹¸ç¦ï¼Œå¦‚ä½ å¸¦ç»™æˆ‘çš„æ¸©æš–ä¸€æ ·",
      "è¿™äº›é’±ä¹°ä¸åˆ°çš„ï¼Œæ˜¯æˆ‘ä¸ºä½ å¿ƒåŠ¨çš„æ¯ä¸€åˆ»",
      "ä¸ä½ åœ¨ä¸€èµ·çš„æ¯ä¸€å¤©ï¼Œéƒ½æ˜¯æˆ‘æœ€å¤§çš„è´¢å¯Œ",
      "ä½ ä¸ä»…èµ¢å¾—äº†æ¸¸æˆï¼Œæ›´èµ¢å¾—äº†æˆ‘å…¨éƒ¨çš„çˆ±",
      "ç”¨è¿™ç‚¹å°é’±æ¢ä½ ä¸€ç”Ÿçš„ç¬‘é¢œï¼Œå€¼å¾—",
      "å½“çˆ±æƒ…å’Œé‡‘é’±æ”¾åœ¨å¤©å¹³ä¸¤ç«¯ï¼Œæˆ‘é€‰æ‹©äº†çˆ±ä½ ",
      "è¿™ä¸–é—´æœ€ç”œèœœçš„è´¥ä»—ï¼Œå°±æ˜¯è¾“ç»™äº†ä½ çš„ç¬‘å®¹"
    ];

    // éšè—æ¨¡å¼æˆåŠŸè§£é”æ¶ˆæ¯
    const SECRET_MODE_SUCCESS_MESSAGES = [
      "âœ¨ æ­å–œä½ è§£é”äº†éšè—æ¨¡å¼ï¼",
      "ğŸ‰ ç”œèœœå®è—æ¨¡å¼å·²å¼€å¯ï¼Œäº«å—ç¨³èµšä¸èµ”çš„ç”œèœœä½“éªŒå§ï¼",
      "ğŸ’– ä½ å‘ç°äº†æˆ‘ä»¬çš„å°ç§˜å¯†ï¼Œè¿™ä¸ªæ¨¡å¼ä¿è¯ä½ æ¯æ¬¡éƒ½èƒ½èµ¢ï¼",
      "ğŸŒŸ ç‰¹æ®Šæ¨¡å¼æ¿€æ´»æˆåŠŸï¼Œä¸€èµ·å¼€å¯ç”œèœœæ—…ç¨‹å§ï¼"
    ];

    // éšè—æ¨¡å¼å¤±è´¥æ¶ˆæ¯
    const SECRET_MODE_FAIL_MESSAGES = [
      "ğŸ’• å¯†ç ä¸å¯¹å“¦ï¼Œä½†æ²¡å…³ç³»ï¼Œä¹Ÿè®¸ä¸‹æ¬¡ä¼šæ›´å¹¸è¿~",
      "ğŸŒ¸ å·®ä¸€ç‚¹ç‚¹å°±å¯¹äº†ï¼Œç›¸ä¿¡ä½ ä¸‹æ¬¡ä¸€å®šèƒ½çŒœåˆ°ï¼",
      "ğŸ€ è™½ç„¶è¿™æ¬¡æ²¡è§£é”æˆåŠŸï¼Œä½†æˆ‘ä»¬çš„æ¸¸æˆä¾ç„¶å¾ˆç”œèœœï¼",
      "ğŸŒˆ å†æ¥å†å‰ï¼Œæ¯ä¸€æ¬¡å°è¯•éƒ½æ˜¯çˆ±çš„è§è¯~"
    ];

    // åˆ›å»ºæœ¬åœ°å­˜å‚¨é”®
    const STORAGE_KEY = "sweetGameData";

    // æ¸¸æˆçŠ¶æ€
    let gameState = {
      playerMoney: 5.2,
      botMoney: 20,
      target: 15,
      blessing: false,
      luckyClover: false,
      round: 0,
      gameOver: false,
      history: [],
      mode: 1,
      events: [], // å°†æ ¹æ®æ¨¡å¼åŠ¨æ€å¡«å……
      choices: [], // å°†æ ¹æ®æ¨¡å¼åŠ¨æ€å¡«å……
      hasPlayed: false
    };

    // DOM å…ƒç´ 
    const playerMoneyEl = document.getElementById('player-money');
    const botMoneyEl = document.getElementById('bot-money');
    const messageEl = document.getElementById('message');
    const diceEl = document.getElementById('dice');
    const buttonsEl = document.getElementById('buttons');
    const progressBarEl = document.getElementById('progress-bar');
    const inputAreaEl = document.getElementById('input-area');
    const inputTextEl = document.getElementById('input-text');
    const submitBtnEl = document.getElementById('submit-btn');
    const startBtnEl = document.getElementById('start-btn');
    const historyContainerEl = document.getElementById('history-container');
    const historyEl = document.getElementById('history');
    const modeGridEl = document.getElementById('mode-grid');
    const modeSelectionEl = document.getElementById('mode-selection');
    const gameContainerEl = document.getElementById('game-container');
    const modeIndicatorEl = document.getElementById('mode-indicator');
    const adminPanelEl = document.getElementById('admin-panel');
    const adminTriggerEl = document.getElementById('admin-trigger');
    const adminPasswordEl = document.getElementById('admin-password');
    const adminResetEl = document.getElementById('admin-reset');
    const playedNoticeEl = document.getElementById('played-notice');

    // åˆå§‹åŒ–æ¸¸æˆæ•°æ®
    function initGameData(modeId) {
      const mode = GAME_MODES.find(m => m.id === modeId) || GAME_MODES[0];

      gameState = {
        playerMoney: mode.playerMoney,
        botMoney: mode.botMoney,
        target: mode.target,
        blessing: false,
        luckyClover: false,
        round: 0,
        gameOver: false,
        history: [],
        mode: mode.id,
        events: [],
        choices: [],
        hasPlayed: false
      };

      // æ ¹æ®æ¨¡å¼éš¾åº¦è®¾ç½®äº‹ä»¶å’Œé€‰æ‹©
      setupEventsAndChoices(mode);

      // æ›´æ–°UI
      modeIndicatorEl.textContent = `æ¨¡å¼${mode.id}: ${mode.name}`;
      playerMoneyEl.textContent = gameState.playerMoney.toFixed(1);
      botMoneyEl.textContent = gameState.botMoney.toFixed(1);

      // æ›´æ–°æ¬¢è¿æ¶ˆæ¯ï¼Œæ˜¾ç¤ºæ­£ç¡®çš„å¥–æ± é‡‘é¢
      messageEl.innerHTML = `
        å®è´ï¼Œæˆ‘ä»¬æ¥ç©ä¸ªè¶…ç”œå°æ¸¸æˆï¼<br>
        ä½ åˆå§‹èµ„é‡‘ğŸ’°ï¼š${gameState.playerMoney.toFixed(1)}å…ƒï¼ˆæˆ‘çˆ±ä½ å“Ÿ~ï¼‰<br>
        æˆ‘å‡º${gameState.botMoney.toFixed(1)}å…ƒå½“å¥–æ± ï¼Œèµšåˆ°${gameState.target.toFixed(1)}å…ƒæˆ‘å°±è®¤è¾“ï¼<br>
      `;

      // æ›´æ–°è¿›åº¦æ¡
      updateUI();

      return gameState;
    }

    // å¤„ç†æ¸¸æˆç»“æœï¼Œç¡®ä¿é‡‘é¢åœ¨å…è®¸èŒƒå›´å†…
    function processGameResult(moneyChange, mode) {
      // åº”ç”¨éšæœºæ³¢åŠ¨ï¼Œå¢åŠ æ¸¸æˆéšæœºæ€§
      const randomFactor = 0.8 + Math.random() * 0.4; // 0.8-1.2ä¹‹é—´çš„éšæœºæ•°
      moneyChange = moneyChange * randomFactor;

      // å¦‚æœæ˜¯éšè—æ¨¡å¼ï¼Œç¡®ä¿æ‰€æœ‰æ”¶ç›Šåœ¨1-5å…ƒä¹‹é—´
      if (mode.id === 99) {
        if (moneyChange <= 0) {
          // éšè—æ¨¡å¼ä¿è¯èµšé’±
          moneyChange = 0.5 + Math.random() * 1.5; // 0.5-2.0ä¹‹é—´çš„éšæœºæ•°
        }

        // æ§åˆ¶æ”¶ç›Šä¸Šé™ä¸º5å…ƒ
        if (moneyChange > 5.0) {
          moneyChange = 5.0;
        }

        // æ§åˆ¶å°äº2å…ƒçš„æ¦‚ç‡ä¸º70%
        if (Math.random() < 0.7 && moneyChange > 2.0) {
          moneyChange = 1.0 + Math.random(); // 1.0-2.0ä¹‹é—´
        }
      } else {
        // å¯¹äºæ™®é€šæ¨¡å¼ï¼Œç¡®ä¿ä¸è¶…è¿‡æœ€å¤§æ”¶ç›Šå’Œæœ€å¤§äºæŸ
        if (moneyChange > 0) {
          // æ”¶ç›Šä¸è¶…è¿‡æ¨¡å¼çš„æœ€å¤§æ”¶ç›Š
          moneyChange = Math.min(moneyChange, mode.maxWin);
        } else {
          // äºæŸä¸è¶…è¿‡æ¨¡å¼çš„æœ€å¤§äºæŸ
          moneyChange = Math.max(moneyChange, -mode.maxLoss);
        }
      }

      return moneyChange;
    }

    // æ ¹æ®æ¨¡å¼è®¾ç½®äº‹ä»¶å’Œé€‰æ‹©
    function setupEventsAndChoices(mode) {
      // åŸºç¡€äº‹ä»¶æ€»æ˜¯åŒ…å«
      gameState.events = [...BASE_EVENTS];

      // æ ¹æ®æ¨¡å¼éš¾åº¦æ·»åŠ é¢å¤–äº‹ä»¶
      const goodEventsToAdd = Math.floor(mode.id / 2);  // æ¯2çº§éš¾åº¦å¢åŠ ä¸€ä¸ªå¥½äº‹ä»¶
      const badEventsToAdd = Math.max(0, Math.floor((mode.id - 5) / 2)); // ä»ç¬¬5çº§å¼€å§‹æ¯2çº§éš¾åº¦å¢åŠ ä¸€ä¸ªåäº‹ä»¶

      // éšæœºé€‰æ‹©å¹¶æ·»åŠ å¥½äº‹ä»¶
      const shuffledGoodEvents = EXTRA_EVENTS.good.sort(() => Math.random() - 0.5);
      for (let i = 0; i < goodEventsToAdd && i < shuffledGoodEvents.length; i++) {
        gameState.events.push({
          type: 'good',
          ...shuffledGoodEvents[i]
        });
      }

      // éšæœºé€‰æ‹©å¹¶æ·»åŠ åäº‹ä»¶
      const shuffledBadEvents = EXTRA_EVENTS.bad.sort(() => Math.random() - 0.5);
      for (let i = 0; i < badEventsToAdd && i < shuffledBadEvents.length; i++) {
        gameState.events.push({
          type: 'bad',
          ...shuffledBadEvents[i]
        });
      }

      // åŸºç¡€é€‰æ‹©æ€»æ˜¯åŒ…å«
      gameState.choices = [...BASE_CHOICES];

      // æ ¹æ®æ¨¡å¼éš¾åº¦æ·»åŠ é¢å¤–é€‰æ‹©
      const choicesToAdd = Math.floor(mode.id / 2);

      // éšæœºé€‰æ‹©å¹¶æ·»åŠ é¢å¤–é€‰æ‹©
      const shuffledChoices = EXTRA_CHOICES.sort(() => Math.random() - 0.5);
      for (let i = 0; i < choicesToAdd && i < shuffledChoices.length; i++) {
        gameState.choices.push(shuffledChoices[i]);
      }
    }

    // ä¿å­˜æ¸¸æˆæ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
    function saveGameData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({
        playerMoney: gameState.playerMoney,
        botMoney: gameState.botMoney,
        mode: gameState.mode,
        history: gameState.history,
        hasPlayed: true,
        gameOver: gameState.gameOver,
        date: new Date().toLocaleString()
      }));
    }

    // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ¸¸æˆæ•°æ®
    function loadGameData() {
      const savedData = localStorage.getItem(STORAGE_KEY);
      if (savedData) {
        return JSON.parse(savedData);
      }
      return null;
    }

    // é‡ç½®æ¸¸æˆæ•°æ®
    function resetGameData() {
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    }

    // æ˜¾ç¤ºæ¨¡å¼é€‰æ‹©ç•Œé¢
    function showModeSelection() {
      modeSelectionEl.classList.remove('hide');
      gameContainerEl.classList.add('hide');

      // æ¸…ç©ºæ¨¡å¼åˆ—è¡¨
      modeGridEl.innerHTML = '';

      // æ·»åŠ æ¨¡å¼æŒ‰é’®
      GAME_MODES.forEach(mode => {
        // è·³è¿‡éšè—æ¨¡å¼
        if (mode.isHidden) return;

        const modeBtn = document.createElement('div');
        modeBtn.className = 'mode-btn';
        modeBtn.innerHTML = `
          <div class="mode-title">æ¨¡å¼${mode.id}: ${mode.name}</div>
          <div class="mode-desc">${mode.description}</div>
        `;

        modeBtn.addEventListener('click', () => {
          initGameData(mode.id);
          modeSelectionEl.classList.add('hide');
          gameContainerEl.classList.remove('hide');
        });

        modeGridEl.appendChild(modeBtn);
      });
    }

    // æ˜¾ç¤ºæ¸¸æˆå†å²è®°å½•
    function showGameHistory(data) {
      modeSelectionEl.classList.remove('hide');
      gameContainerEl.classList.add('hide');
      playedNoticeEl.classList.remove('hide');

      // æ¸…ç©ºå†å²è®°å½•å®¹å™¨
      historyEl.innerHTML = '';

      // æ·»åŠ æ¨¡å¼ä¿¡æ¯
      const modeInfo = document.createElement('div');
      modeInfo.className = 'history-item';
      const mode = GAME_MODES.find(m => m.id === data.mode) || GAME_MODES[0];
      modeInfo.innerHTML = `<strong>æ¸¸æˆæ¨¡å¼:</strong> æ¨¡å¼${mode.id}: ${mode.name}<br>
                           <strong>æ¸¸æˆæ—¶é—´:</strong> ${data.date || 'æœªçŸ¥'}<br>
                           <strong>æœ€ç»ˆèµ„é‡‘:</strong> ${data.playerMoney.toFixed(1)}å…ƒ<br>
                           <strong>ç»“æœ:</strong> ${data.gameOver ? 'æ¸¸æˆç»“æŸ' : 'æœªå®Œæˆ'}`;
      historyEl.appendChild(modeInfo);

      // æ·»åŠ æ¸¸æˆå†å²è®°å½•
      if (data.history && data.history.length > 0) {
        // æ·»åŠ åˆ†éš”çº¿
        const separator = document.createElement('div');
        separator.className = 'history-item';
        separator.innerHTML = '<hr><strong>æ¸¸æˆè®°å½•:</strong>';
        historyEl.appendChild(separator);

        // æ·»åŠ å†å²æ¡ç›®
        data.history.forEach((item, index) => {
          const historyItem = document.createElement('div');
          historyItem.className = 'history-item';
          historyItem.textContent = item;
          historyEl.appendChild(historyItem);
        });
      }

      historyContainerEl.classList.remove('hide');

      // ç¦ç”¨æ¨¡å¼é€‰æ‹©
      const modeBtns = document.querySelectorAll('.mode-btn');
      modeBtns.forEach(btn => {
        btn.style.opacity = '0.5';
        btn.style.pointerEvents = 'none';
      });
    }

    // æ›´æ–°UI
    function updateUI() {
      playerMoneyEl.textContent = gameState.playerMoney.toFixed(1);
      botMoneyEl.textContent = gameState.botMoney.toFixed(1);

      // æ›´æ–°è¿›åº¦æ¡
      const progress = (gameState.playerMoney / gameState.target) * 100;
      progressBarEl.style.width = `${Math.min(progress, 100)}%`;
    }

    // æ·»åŠ å†å²è®°å½•
    function addHistory(text) {
      gameState.history.push(text);
      const historyItem = document.createElement('div');
      historyItem.className = 'history-item';
      historyItem.textContent = text;
      historyEl.appendChild(historyItem);
      historyEl.scrollTop = historyEl.scrollHeight;

      if (gameState.history.length > 0) {
        historyContainerEl.classList.remove('hide');
      }

      // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      saveGameData();
    }

    // æ·éª°å­
    function rollDice() {
      return Math.floor(Math.random() * 6) + 1;
    }

    // è·å–éšæœºäº‹ä»¶
    function getRandomEvent() {
      const mode = GAME_MODES.find(m => m.id === gameState.mode);

      // åº”ç”¨æ¨¡å¼çš„èƒœç‡å’Œè¾“ç‡
      const randomValue = Math.random();
      let eventType;

      // ä¿æŠ¤æœºåˆ¶ï¼šèµ„é‡‘ä½äº3å…ƒæ—¶å¿…è§¦å‘å¥½è¿äº‹ä»¶
      if (gameState.playerMoney < 3) {
        eventType = 'good';
      }
      // ä¿æŠ¤æœºåˆ¶ï¼šèµ„é‡‘ä½äº8å…ƒæ—¶é«˜æ¦‚ç‡è§¦å‘å¥½äº‹ä»¶
      else if (gameState.playerMoney < 8 && randomValue < 0.7) {
        eventType = 'good';
      }
      // æ­£å¸¸éšæœºï¼Œä½†æ ¹æ®æ¨¡å¼éš¾åº¦è°ƒæ•´
      else {
        eventType = randomValue < mode.winChance ? 'good' : 'bad';
      }

      // ç­›é€‰ç¬¦åˆç±»å‹çš„äº‹ä»¶
      const filteredEvents = gameState.events.filter(event => event.type === eventType);

      // éšæœºé€‰æ‹©ä¸€ä¸ªäº‹ä»¶
      return filteredEvents[Math.floor(Math.random() * filteredEvents.length)];
    }

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(message) {
      messageEl.innerHTML = message;
    }

    // æ¸…ç©ºæŒ‰é’®åŒºåŸŸ
    function clearButtons() {
      buttonsEl.innerHTML = '';
    }

    // æ·»åŠ æŒ‰é’®
    function addButton(text, callback) {
      const button = document.createElement('button');
      button.textContent = text;
      button.addEventListener('click', callback);
      buttonsEl.appendChild(button);
      return button;
    }

    // æ·»åŠ é€‰æ‹©æŒ‰é’®
    function addChoiceButton(text, callback) {
      const button = document.createElement('button');
      button.textContent = text;
      button.className = 'choice-btn';
      button.addEventListener('click', callback);
      buttonsEl.appendChild(button);
      return button;
    }

    // æ¸¸æˆç»“æŸ
    function gameEnd() {
      gameState.gameOver = true;
      clearButtons();
      diceEl.textContent = '';

      // è·å–å½“å‰æ¨¡å¼
      const mode = GAME_MODES.find(m => m.id === gameState.mode);

      // é€‰æ‹©ä¸€æ¡éšæœºå‘Šç™½è¯­
      const randomMessage = SWEET_MESSAGES[Math.floor(Math.random() * SWEET_MESSAGES.length)];

      // è®¡ç®—å¥–åŠ±é‡‘é¢ï¼ˆä¸ºæ¨¡å¼çš„1/10ï¼‰
      const rewardAmount = Math.round(mode.botMoney / 10);

      const finalMessage = document.createElement('div');
      finalMessage.className = 'final-message';
      finalMessage.innerHTML = `
        ğŸ‰ èƒœåˆ©ç»“å±€ï¼š<br>
        å®è´å¤ªå‰å®³å•¦ï¼ä½ èµšåˆ°${gameState.target}å…ƒ~<br>
        æˆ‘è®¤è¾“ï¼å¥‰ä¸Š${rewardAmount}å…ƒçº¢åŒ…ğŸ§§+æƒ…è¯ï¼š<br>
        "${randomMessage}"
      `;

      const redPacket = document.createElement('div');
      redPacket.className = 'red-packet';
      redPacket.textContent = 'ğŸ§§';

      buttonsEl.appendChild(finalMessage);
      buttonsEl.appendChild(redPacket);

      // ä¿å­˜æ¸¸æˆæ•°æ®
      saveGameData();

      // æ·»åŠ æ¸¸æˆç»“æŸè®°å½•
      addHistory(`æ¸¸æˆç»“æŸ: æœ€ç»ˆèµ„é‡‘ ${gameState.playerMoney.toFixed(1)}å…ƒ`);
    }

    // æ¸¸æˆå›åˆ
    function gameRound() {
      gameState.round++;
      clearButtons();

      // è·å–å½“å‰æ¨¡å¼
      const mode = GAME_MODES.find(m => m.id === gameState.mode);

      // æ·éª°å­
      const dice = rollDice();
      diceEl.textContent = `ğŸ² ${dice}`;

      // è·å–äº‹ä»¶
      let event = getRandomEvent();

      // ç‰¹æ®Šä¿æŠ¤ï¼šèµ„é‡‘<10å…ƒä¸”æ·å‡ºäº†<3ç‚¹æ—¶ï¼Œè§¦å‘å¥½äº‹ä»¶
      if (gameState.playerMoney < 10 && dice < 3 && gameState.mode <= 5) {
        const goodEvents = gameState.events.filter(e => e.type === 'good');
        event = goodEvents[Math.floor(Math.random() * goodEvents.length)];
      }

      // è®¡ç®—é‡‘é’±å˜åŒ–ï¼ˆåº”ç”¨æ¨¡å¼ä¹˜æ•°ï¼‰
      let moneyChange = event.effect(dice) * mode.eventMultiplier;

      // å¤„ç†æ¸¸æˆç»“æœï¼Œç¡®ä¿é‡‘é¢åœ¨å…è®¸èŒƒå›´å†…
      moneyChange = processGameResult(moneyChange, mode);

      // åº”ç”¨ç¥ç¦æ•ˆæœ
      if (gameState.blessing && moneyChange > 0) {
        moneyChange *= 2;
      }

      // åº”ç”¨å››å¶è‰æ•ˆæœ
      if (gameState.luckyClover && moneyChange > 0) {
        moneyChange *= 1.5;
        gameState.luckyClover = false; // ä½¿ç”¨ä¸€æ¬¡åæ¶ˆå¤±
      }

      // æ ¼å¼åŒ–é‡‘é’±å˜åŒ–
      const formattedChange = moneyChange > 0 ? `+${moneyChange.toFixed(1)}` : moneyChange.toFixed(1);

      // æ›´æ–°æ¶ˆæ¯
      let message = `
        ğŸ² æ·éª°å­... ${dice}ç‚¹ï¼<br>
        ${event.icon} äº‹ä»¶ï¼š${event.title}<br>
        ${event.description}<br>
      `;

      // æ˜¾ç¤ºç¥ç¦æ•ˆæœ
      if (gameState.blessing && moneyChange > 0) {
        message += `<span class="blessing">âœ¨ è§¦å‘ç²¾çµç¥ç¦ï¼æ”¶ç›Šx2ï¼</span><br>`;
        gameState.blessing = false;  // ç”¨å®Œç¥ç¦
      }

      // æ˜¾ç¤ºå››å¶è‰æ•ˆæœ
      if (gameState.luckyClover && moneyChange > 0) {
        message += `<span class="blessing">ğŸ€ è§¦å‘å¹¸è¿å››å¶è‰ï¼æ”¶ç›Šx1.5ï¼</span><br>`;
        gameState.luckyClover = false;  // ç”¨å®Œå¹¸è¿
      }

      message += `ğŸ’° èµ„é‡‘${formattedChange}å…ƒ<br>`;
      message += `â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>`;

      // æ›´æ–°é‡‘é’±
      gameState.playerMoney += moneyChange;
      gameState.botMoney -= moneyChange;

      // ç¡®ä¿ä¸ä¼šä½äºæœ€å¤§äºæŸé™åˆ¶ï¼ˆä¿æŠ¤æœºåˆ¶ï¼‰
      const minMoney = gameState.playerMoney < mode.playerMoney - mode.maxLoss ?
                       mode.playerMoney - mode.maxLoss :
                       gameState.playerMoney;

      if (gameState.playerMoney < minMoney) {
        gameState.playerMoney = minMoney;
      }

      // æ£€æŸ¥æ˜¯å¦è¾¾æˆèƒœåˆ©æ¡ä»¶
      if (gameState.playerMoney >= gameState.target) {
        showMessage(message + `ğŸ‰ æ­å–œä½ è¾¾åˆ°äº†ç›®æ ‡é‡‘é¢ï¼`);
        updateUI();
        gameEnd();
        return;
      }

      // æ˜¾ç¤ºè¿›åº¦ä¿¡æ¯
      const remainingAmount = gameState.target - gameState.playerMoney;
      message += `ğŸ˜ è¿›åº¦ï¼šè¿˜å·®${remainingAmount.toFixed(1)}å…ƒï¼<br>`;

      showMessage(message);
      updateUI();

      // æ·»åŠ å†å²è®°å½•
      addHistory(`å›åˆ${gameState.round}: ${event.title} (${formattedChange}å…ƒ)`);

      // éšæœºå†³ç­–ç‚¹
      if (Math.random() < 0.5) {
        const choiceSet = gameState.choices[Math.floor(Math.random() * gameState.choices.length)];
        setTimeout(() => {
          showMessage(message + `ğŸ‘‰ ${choiceSet.title}ï¼š`);

          // æ¸…ç©ºæŒ‰é’®åŒºåŸŸï¼Œç¡®ä¿æ²¡æœ‰å¤šä½™çš„æŒ‰é’®
          clearButtons();

          // æ·»åŠ é€‰æ‹©æŒ‰é’®
          choiceSet.options.forEach((option, index) => {
            addChoiceButton(`${index + 1}. ${option.text}`, () => {
              // ç«‹å³æ¸…é™¤æ‰€æœ‰æŒ‰é’®ï¼Œé˜²æ­¢å¤šæ¬¡ç‚¹å‡»
              clearButtons();

              const choiceDice = rollDice();
              let choiceEffect = option.effect(choiceDice) * mode.eventMultiplier;

              // å¤„ç†æ¸¸æˆç»“æœï¼Œç¡®ä¿é‡‘é¢åœ¨å…è®¸èŒƒå›´å†…
              choiceEffect = processGameResult(choiceEffect, mode);

              // ä¿æŠ¤æœºåˆ¶ï¼šå¦‚æœé’±å°‘äº3å…ƒï¼Œå¼ºåˆ¶å¥½ç»“æœ
              if (gameState.playerMoney < 3 && choiceEffect < 0) {
                choiceEffect = Math.abs(choiceEffect);
              }

              gameState.playerMoney += choiceEffect;
              gameState.botMoney -= choiceEffect;

              // ç¡®ä¿ä¸ä¼šä½äºæœ€å¤§äºæŸé™åˆ¶
              const minMoney = gameState.playerMoney < mode.playerMoney - mode.maxLoss ?
                              mode.playerMoney - mode.maxLoss :
                              gameState.playerMoney;

              if (gameState.playerMoney < minMoney) {
                gameState.playerMoney = minMoney;
              }

              const formattedEffect = choiceEffect > 0 ? `+${choiceEffect.toFixed(1)}` : choiceEffect.toFixed(1);

              showMessage(`
                ä½ é€‰æ‹©äº†ï¼š${option.text}<br>
                ğŸ² æ·éª°å­... ${choiceDice}ç‚¹ï¼<br>
                ğŸ’° èµ„é‡‘${formattedEffect}å…ƒ<br>
                ğŸ’° å½“å‰èµ„é‡‘ï¼š${gameState.playerMoney.toFixed(1)}å…ƒ<br>
                â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”<br>
              `);

              updateUI();
              addHistory(`é€‰æ‹©: ${option.text} (${formattedEffect}å…ƒ)`);

              // æ£€æŸ¥æ˜¯å¦è¾¾æˆèƒœåˆ©æ¡ä»¶
              if (gameState.playerMoney >= gameState.target) {
                gameEnd();
                return;
              }

              // ç»§ç»­æ¸¸æˆï¼ˆæ¸…é™¤ä¹‹å‰çš„æ‰€æœ‰æŒ‰é’®åæ·»åŠ ï¼‰
              clearButtons();
              addButton('ç»§ç»­', gameRound);
            });
          });
        }, 1000);
      } else {
        // ç›´æ¥ç»§ç»­ï¼ˆç¡®ä¿æ¸…é™¤ä¹‹å‰çš„æŒ‰é’®ï¼‰
        clearButtons();
        addButton('ç»§ç»­', gameRound);
      }
    }

    // å¼€å§‹æ¸¸æˆ
    startBtnEl.addEventListener('click', () => {
      startBtnEl.remove();
      showMessage('å‡†å¤‡å¼€å§‹æ¸¸æˆï¼æ·éª°å­å†³å®šä½ çš„å‘½è¿å§ï¼');

      // å»¶è¿Ÿä¸€ä¸‹å¼€å§‹æ¸¸æˆï¼Œå¢åŠ æœŸå¾…æ„Ÿ
      setTimeout(gameRound, 1000);
    });

    // æäº¤è¾“å…¥
    submitBtnEl.addEventListener('click', () => {
      const input = inputTextEl.value.trim();
      if (input) {
        inputTextEl.value = '';
        inputAreaEl.classList.add('hide');

        // æ£€æŸ¥æ˜¯å¦æ˜¯ç®¡ç†å‘˜å¯†ç 
        if (input === ADMIN_PASSWORD) {
          resetGameData();
        }
      }
    });

    // ç®¡ç†å‘˜é¢æ¿è§¦å‘å™¨
    adminTriggerEl.addEventListener('click', () => {
      adminPanelEl.classList.toggle('hide');
    });

    // ç®¡ç†å‘˜é‡ç½®æŒ‰é’®
    adminResetEl.addEventListener('click', () => {
      const password = adminPasswordEl.value.trim();
      if (password === ADMIN_PASSWORD) {
        resetGameData();
      } else {
        showToast('å¯†ç é”™è¯¯ï¼');
      }
    });

    // åˆå§‹åŒ–æ¸¸æˆ
    function initGame() {
      // æ£€æŸ¥æ˜¯å¦å·²ç»ç©è¿‡
      const savedData = loadGameData();

      if (savedData && savedData.hasPlayed) {
        // æ˜¾ç¤ºå†å²è®°å½•
        showGameHistory(savedData);
      } else {
        // æ˜¾ç¤ºæ¨¡å¼é€‰æ‹©
        showModeSelection();
      }
    }

    // é‡ç½®æŒ‰é’®å’Œå¯†ç å¼¹çª—ç›¸å…³å…ƒç´ 
    const resetGameBtnEl = document.getElementById('reset-game-btn');
    const resetModalEl = document.getElementById('reset-modal');
    const resetPasswordEl = document.getElementById('reset-password');
    const confirmResetEl = document.getElementById('confirm-reset');
    const cancelResetEl = document.getElementById('cancel-reset');

    // ç‚¹å‡»é‡ç½®æŒ‰é’®ï¼Œæ˜¾ç¤ºå¯†ç è¾“å…¥å¼¹çª—
    resetGameBtnEl.addEventListener('click', () => {
      resetModalEl.classList.remove('hide');
      resetModalEl.style.display = 'flex';
      resetPasswordEl.value = ''; // æ¸…ç©ºå¯†ç è¾“å…¥æ¡†
      resetPasswordEl.focus();
    });

    // ç‚¹å‡»å–æ¶ˆæŒ‰é’®ï¼Œéšè—å¯†ç å¼¹çª—
    cancelResetEl.addEventListener('click', () => {
      resetModalEl.classList.add('hide');
      resetModalEl.style.display = 'none';
    });

    // ç‚¹å‡»ç¡®è®¤é‡ç½®æŒ‰é’®ï¼ŒéªŒè¯å¯†ç å¹¶é‡ç½®æ¸¸æˆ
    confirmResetEl.addEventListener('click', () => {
      const password = resetPasswordEl.value.trim();
      if (password === ADMIN_PASSWORD) {
        resetGameData();
        resetModalEl.classList.add('hide');
        resetModalEl.style.display = 'none';
      } else {
        showToast('å¯†ç é”™è¯¯ï¼');
        resetPasswordEl.value = '';
        resetPasswordEl.focus();
      }
    });

    // ç›‘å¬å¯†ç è¾“å…¥æ¡†çš„å›è½¦é”®
    resetPasswordEl.addEventListener('keyup', (event) => {
      if (event.key === 'Enter') {
        confirmResetEl.click();
      }
    });

    // éšè—æ¨¡å¼ç›¸å…³å…ƒç´ 
    const secretModeBtnEl = document.getElementById('secret-mode-btn');
    const secretModeModalEl = document.getElementById('secret-mode-modal');
    const secretModePasswordEl = document.getElementById('secret-mode-password');
    const confirmSecretEl = document.getElementById('confirm-secret');
    const cancelSecretEl = document.getElementById('cancel-secret');

    // ç‚¹å‡»éšè—æ¨¡å¼æŒ‰é’®ï¼Œæ˜¾ç¤ºå¯†ç è¾“å…¥å¼¹çª—
    secretModeBtnEl.addEventListener('click', () => {
      secretModeModalEl.classList.remove('hide');
      secretModeModalEl.style.display = 'flex';
      secretModePasswordEl.value = ''; // æ¸…ç©ºå¯†ç è¾“å…¥æ¡†
      secretModePasswordEl.focus();
    });

    // ç‚¹å‡»å–æ¶ˆæŒ‰é’®ï¼Œéšè—å¯†ç å¼¹çª—
    cancelSecretEl.addEventListener('click', () => {
      secretModeModalEl.classList.add('hide');
      secretModeModalEl.style.display = 'none';
    });

    // ç‚¹å‡»ç¡®è®¤è§£é”æŒ‰é’®ï¼ŒéªŒè¯å¯†ç å¹¶è§£é”éšè—æ¨¡å¼
    confirmSecretEl.addEventListener('click', () => {
      const password = secretModePasswordEl.value.trim();
      secretModeModalEl.classList.add('hide');
      secretModeModalEl.style.display = 'none';

      if (password === SECRET_MODE_PASSWORD) {
        // 50%æ¦‚ç‡è§£é”æˆåŠŸ
        const isSuccess = Math.random() < 0.5;

        if (isSuccess) {
          // è§£é”æˆåŠŸ
          const randomSuccess = SECRET_MODE_SUCCESS_MESSAGES[Math.floor(Math.random() * SECRET_MODE_SUCCESS_MESSAGES.length)];
          showToast(randomSuccess);

          // åˆå§‹åŒ–éšè—æ¨¡å¼
          initGameData(99); // éšè—æ¨¡å¼IDä¸º99
          modeSelectionEl.classList.add('hide');
          gameContainerEl.classList.remove('hide');
        } else {
          // è§£é”å¤±è´¥
          const randomFail = SECRET_MODE_FAIL_MESSAGES[Math.floor(Math.random() * SECRET_MODE_FAIL_MESSAGES.length)];
          showToast(randomFail);
        }
      } else {
        // å¯†ç é”™è¯¯
        showToast('å¯†ç ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•');
      }
    });

    // ç›‘å¬éšè—æ¨¡å¼å¯†ç è¾“å…¥æ¡†çš„å›è½¦é”®
    secretModePasswordEl.addEventListener('keyup', (event) => {
      if (event.key === 'Enter') {
        confirmSecretEl.click();
      }
    });

        // å¯åŠ¨æ¸¸æˆ
    initGame();

    // èŠ±ç“£é£˜è½ç‰¹æ•ˆ
    (function() {
      const canvas = document.getElementById('petals-canvas');
      const ctx = canvas.getContext('2d');
      let petals = [];
      const petalColors = [
        '#ffb6c1', // æµ…ç²‰çº¢
        '#ff69b4', // çƒ­æƒ…ç²‰çº¢
        '#ffc0cb', // ç²‰çº¢
        '#db7093', // è‹ç™½çš„ç´«ç½—å…°çº¢è‰²
        '#e6a8d7', // æ·¡ç´«è‰²
        '#f8bbd0'  // æµ…ç²‰è‰²
      ];

      // èŠ±ç“£ç±»å‹å’Œè®¡æ•°
      const petalTypes = 5; // èŠ±ç“£ç±»å‹æ•°é‡
      let animationFrameId = null; // ç”¨äºå­˜å‚¨åŠ¨ç”»å¸§IDï¼Œæ–¹ä¾¿æ§åˆ¶
      let petalCount = 30; // é»˜è®¤èŠ±ç“£æ•°é‡ï¼Œå°†æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´

      // è°ƒæ•´ç”»å¸ƒå¤§å°
      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

            // åˆ›å»ºèŠ±ç“£å¯¹è±¡
      function createPetal() {
        const x = Math.random() * canvas.width;
        const y = -50; // ä»ç”»å¸ƒé¡¶éƒ¨ä»¥å¤–å¼€å§‹
        const size = 15 + Math.random() * 15; // èŠ±ç“£å¤§å°
        const speedX = 1 - Math.random() * 2; // æ°´å¹³æ–¹å‘çš„é€Ÿåº¦
        const speedY = 1 + Math.random() * 2; // å‚ç›´æ–¹å‘çš„é€Ÿåº¦
        const rotation = Math.random() * Math.PI * 2; // åˆå§‹æ—‹è½¬è§’åº¦
        const rotationSpeed = (Math.random() - 0.5) * 0.03; // æ—‹è½¬é€Ÿåº¦
        const type = Math.floor(Math.random() * petalTypes); // èŠ±ç“£ç±»å‹
        const color = petalColors[Math.floor(Math.random() * petalColors.length)]; // èŠ±ç“£é¢œè‰²
        const scale = 0.8 + Math.random() * 0.4; // èŠ±ç“£ç¼©æ”¾

        petals.push({
          x,
          y,
          size,
          speedX,
          speedY,
          rotation,
          rotationSpeed,
          type,
          color,
          opacity: 0.7 + Math.random() * 0.3,
          scale,
          // æ·»åŠ æ‘†åŠ¨æ•ˆæœ
          swingFactor: Math.random() * 3,
          swingOffset: Math.random() * Math.PI * 2,
          originalX: x
        });
      }

            // ç»˜åˆ¶å•ä¸ªèŠ±ç“£
      function drawPetal(petal) {
        ctx.save();
        ctx.translate(petal.x, petal.y);
        ctx.rotate(petal.rotation);
        ctx.scale(petal.scale, petal.scale);
        ctx.globalAlpha = petal.opacity;

        // ç»˜åˆ¶èŠ±ç“£å½¢çŠ¶
        ctx.beginPath();
        ctx.fillStyle = petal.color;

        // æ·»åŠ å¾„å‘æ¸å˜æ•ˆæœ
        const gradient = ctx.createRadialGradient(0, 0, 0, 0, 0, petal.size);
        gradient.addColorStop(0, petal.color);
        gradient.addColorStop(1, adjustColor(petal.color, -20));
        ctx.fillStyle = gradient;

        // ä¸åŒç±»å‹çš„èŠ±ç“£å½¢çŠ¶
        switch(petal.type) {
          case 0: // æ¤­åœ†å½¢èŠ±ç“£
            ctx.ellipse(0, 0, petal.size / 2, petal.size, 0, 0, Math.PI * 2);
            break;
          case 1: // æ³ªæ»´å½¢èŠ±ç“£
            ctx.moveTo(0, -petal.size / 2);
            ctx.bezierCurveTo(
              petal.size / 2, -petal.size / 4,
              petal.size / 2, petal.size / 4,
              0, petal.size / 2
            );
            ctx.bezierCurveTo(
              -petal.size / 2, petal.size / 4,
              -petal.size / 2, -petal.size / 4,
              0, -petal.size / 2
            );
            break;
          case 2: // å¿ƒå½¢èŠ±ç“£
            const s = petal.size / 2;
            ctx.moveTo(0, s * 0.3);
            ctx.bezierCurveTo(s * 0.3, -s * 0.3, s, -s * 0.3, s, s * 0.3);
            ctx.bezierCurveTo(s, s * 0.6, s * 0.5, s, 0, s * 1.3);
            ctx.bezierCurveTo(-s * 0.5, s, -s, s * 0.6, -s, s * 0.3);
            ctx.bezierCurveTo(-s, -s * 0.3, -s * 0.3, -s * 0.3, 0, s * 0.3);
            break;
          case 3: // åœ†å½¢èŠ±ç“£
            ctx.arc(0, 0, petal.size / 3, 0, Math.PI * 2);
            break;
          case 4: // èŠ±æœµå½¢èŠ±ç“£
            const p = petal.size / 3;
            for (let i = 0; i < 5; i++) {
              const angle = (i / 5) * Math.PI * 2;
              const x = Math.cos(angle) * p;
              const y = Math.sin(angle) * p;
              if (i === 0) {
                ctx.moveTo(x, y);
              } else {
                ctx.lineTo(x, y);
              }
              const nextAngle = ((i + 0.5) / 5) * Math.PI * 2;
              const controlX = Math.cos(nextAngle) * (p / 0.6);
              const controlY = Math.sin(nextAngle) * (p / 0.6);
              const nextX = Math.cos((i + 1) / 5 * Math.PI * 2) * p;
              const nextY = Math.sin((i + 1) / 5 * Math.PI * 2) * p;
              ctx.quadraticCurveTo(controlX, controlY, nextX, nextY);
            }
            break;
        }

        // æ·»åŠ å…‰æ™•æ•ˆæœ
        if (Math.random() > 0.7) {
          ctx.shadowColor = petal.color;
          ctx.shadowBlur = 5;
        }

        ctx.fill();
        ctx.restore();
      }

                  // è°ƒæ•´é¢œè‰²äº®åº¦
      function adjustColor(color, amount) {
        // å°†é¢œè‰²è½¬æ¢ä¸ºRGB
        let r, g, b;

        // å¤„ç†åå…­è¿›åˆ¶é¢œè‰²
        if (color.startsWith('#')) {
          r = parseInt(color.substring(1, 3), 16);
          g = parseInt(color.substring(3, 5), 16);
          b = parseInt(color.substring(5, 7), 16);
        }
        // å¤„ç†rgb()é¢œè‰²
        else if (color.startsWith('rgb')) {
          const rgbValues = color.match(/\d+/g);
          r = parseInt(rgbValues[0]);
          g = parseInt(rgbValues[1]);
          b = parseInt(rgbValues[2]);
        }

        // è°ƒæ•´äº®åº¦
        r = Math.max(0, Math.min(255, r + amount));
        g = Math.max(0, Math.min(255, g + amount));
        b = Math.max(0, Math.min(255, b + amount));

        return `rgb(${r}, ${g}, ${b})`;
      }

      // æ›´æ–°èŠ±ç“£ä½ç½®
      function updatePetals() {
        const now = Date.now() / 1000;

        // ä½¿ç”¨filterå®‰å…¨åœ°ç§»é™¤å‡ºç•Œçš„èŠ±ç“£
        petals = petals.filter(petal => {
          // åŸºæœ¬ç§»åŠ¨
          petal.y += petal.speedY;

          // æ·»åŠ å·¦å³æ‘†åŠ¨æ•ˆæœ
          petal.x = petal.originalX + Math.sin(now * 0.7 + petal.swingOffset) * petal.swingFactor;

          // æ—‹è½¬æ•ˆæœ
          petal.rotation += petal.rotationSpeed;

          // å¦‚æœèŠ±ç“£è½å‡ºç”»å¸ƒï¼Œä»æ•°ç»„ä¸­ç§»é™¤
          return petal.y <= canvas.height + petal.size;
        });

        // ä¿æŒèŠ±ç“£æ•°é‡
        const targetPetalCount = Math.min(petalCount, Math.floor(canvas.width * canvas.height / 20000));
        while (petals.length < targetPetalCount) {
          createPetal();
        }
      }

            // åŠ¨ç”»å¾ªç¯
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        updatePetals();

        petals.forEach(drawPetal);

        animationFrameId = requestAnimationFrame(animate);
      }

      // æš‚åœåŠ¨ç”»
      function pauseAnimation() {
        if (animationFrameId) {
          cancelAnimationFrame(animationFrameId);
          animationFrameId = null;
        }
      }

      // æ¢å¤åŠ¨ç”»
      function resumeAnimation() {
        if (!animationFrameId) {
          animate();
        }
      }

      // åœ¨é¡µé¢å¯è§æ€§å˜åŒ–æ—¶æ§åˆ¶åŠ¨ç”»
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          pauseAnimation();
        } else {
          resumeAnimation();
        }
      });

            // åˆå§‹åŒ–
      function init() {
        resizeCanvas();

        // åˆå§‹åˆ›å»ºä¸€äº›èŠ±ç“£
        const initialPetalCount = Math.min(30, Math.floor(canvas.width * canvas.height / 25000));
        for (let i = 0; i < initialPetalCount; i++) {
          createPetal();
          // éšæœºåˆ†å¸ƒåˆå§‹ä½ç½®
          petals[i].y = Math.random() * canvas.height;
        }

        // æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´èŠ±ç“£æ•°é‡
        adjustPetalCountForPerformance();

        animate();
      }

      // æ ¹æ®è®¾å¤‡æ€§èƒ½è°ƒæ•´èŠ±ç“£æ•°é‡
      function adjustPetalCountForPerformance() {
        // åˆ›å»ºä¸€ä¸ªæµ‹è¯•å‡½æ•°ï¼Œè¯„ä¼°è®¾å¤‡æ€§èƒ½
        let startTime = performance.now();
        let iterations = 0;

        // è¿è¡Œä¸€ä¸ªç®€å•çš„æµ‹è¯•å¾ªç¯
        while (performance.now() - startTime < 5) {
          iterations++;
          let testArray = [];
          for (let i = 0; i < 1000; i++) {
            testArray.push(Math.random());
          }
        }

        // æ ¹æ®æ€§èƒ½è°ƒæ•´èŠ±ç“£æ•°é‡ä¸Šé™
        // æ€§èƒ½è¶Šå¥½ï¼Œiterationsè¶Šå¤§ï¼ŒèŠ±ç“£æ•°é‡ä¸Šé™è¶Šé«˜
        if (iterations < 100) {
          // ä½æ€§èƒ½è®¾å¤‡
          petalCount = 20;
        } else if (iterations < 500) {
          // ä¸­ç­‰æ€§èƒ½è®¾å¤‡
          petalCount = 30;
        } else {
          // é«˜æ€§èƒ½è®¾å¤‡
          petalCount = 50;
        }
      }

      // çª—å£å¤§å°å˜åŒ–æ—¶è°ƒæ•´ç”»å¸ƒå¤§å°
      window.addEventListener('resize', resizeCanvas);

      // å¯åŠ¨èŠ±ç“£åŠ¨ç”»
      init();
    })();
  </script>
</body>
</html>
